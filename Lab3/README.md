# Lab 3
## –•—ñ–¥ —Ä–æ–±–æ—Ç–∏
1. –°—Ç–≤–æ—Ä–∏–≤ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ —É –ø–∞–ø—Ü—ñ Lab3 —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏–≤ –Ω–∞ –Ω–µ—ó —É—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –ø–∞–∫–µ—Ç–∏
            
       (Lab3) user@Pc:~/GitRepos/DevopsLabs/Lab3$ pipenv install django
       Installing django...
       Adding django to Pipfile's [packages]...
       ‚úî Installation Succeeded 
       Pipfile.lock not found, creating...
       Locking [dev-packages] dependencies...
       Locking [packages] dependencies...
       Building requirements...
       Resolving dependencies...
       ‚úî Success! 
       Updated Pipfile.lock (85c883)!
       Installing dependencies from Pipfile.lock (85c883)...
         üêç   ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ 0/0 ‚Äî 00:00:00
       (Lab3) user@Pc:~/GitRepos/DevopsLabs/Lab3$ 
2. –°—Ç–≤–æ—Ä–∏–≤ –∑–∞–≥–æ—Ç–æ–≤–∫—É —Å–∞–π—Ç—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Django Framework —Ç–∞ –≤–∏–Ω—ñ—Å —Ñ–∞–π–ª–∏ –Ω–∞ —Ä—ñ–≤–µ–Ω—å –≤–∏—â–µ
        
       (Lab3) user@Pc:~/GitRepos/DevopsLabs/Lab3$ pipenv run django-admin startproject my_site
3. –ó–∞–ø—É—Å—Ç–∏–≤ Django —Å–µ—Ä–≤–µ—Ä –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ ```pipenv run python manage.py runserver```<br/>
![](photos/1.jpg)
4. –í—Å–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å —É—Å–ø—ñ—à–Ω–æ —ñ —Å—Ç–∞—Ä—Ç–æ–≤–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ Django –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ. –ó—É–ø–∏–Ω–∏–≤ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ Ctrl-C —Ç–∞ –∑—Ä–æ–±–∏–≤ –∫–æ–º—ñ—Ç.
5. –°—Ç–≤–æ—Ä–∏–≤ —Ç–µ–º–ø–ª–µ–π—Ç —Å–≤–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É (app) —É —è–∫–æ–º—É —Ç–∞ –∑–∞–∫–æ–º—ñ—Ç–∏–≤ —Ü—ñ —Ñ–∞–π–ª–∏ –¥–æ —Å–≤–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é.
6. –°—Ç–≤–æ—Ä–∏–≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é ```templates``` –¥–µ —Å—Ç–≤–æ—Ä–∏–≤ —Ñ–∞–π–ª ```main.html``` –∞ —Ç–∞–∫–æ–∂ –≤ –ø–∞–ø—Ü—ñ ```main``` —Å—Ç–≤–æ—Ä–∏–≤ —Ñ–∞–π–ª ```urls.py```. –ó–∞–∫–æ–º—ñ—Ç–∏–≤ —É—Å–µ –¥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
7. –í—ñ–¥—Ä–µ–¥–∞–≥—É–≤–∞–≤ —Ñ–∞–π–ª–∏ ```my_site/urls.py``` —Ç–∞ ```main/urls.py```.
8. –ü–µ—Ä–µ–π—à–æ–≤ –¥–æ —Å–≤–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É —Ç–∞ –∑–∞–π–Ω—è–≤—Å—è WEB —Å—Ç–æ—Ä—ñ–Ω–∫–∞–º–∏. –î–ª—è —Ü—å–æ–≥–æ:
       
       - —Å—Ç–≤–æ—Ä–∏–≤ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –¥–≤–æ—Ö —Ç–∏–ø—ñ–≤ - –ø–µ—Ä—à–∞ –±—É–¥–µ –∑—á–∏—Ç—É–≤–∞—Ç–∏—Å—å –∑ .html —Ç–µ–º–ø–ª–µ–π—Ç–∞. –¥—Ä—É–≥–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –±—É–¥–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å —É —Ñ–æ—Ä–º–∞—Ç—ñ JSON;
       - –≤—ñ–¥–∫—Ä–∏–≤ —Ç–∞ –æ–∑–Ω–∞–π–æ–º–∏–≤—Å—è —ñ–∑ –≤–º—ñ—Å—Ç–æ–º —Ñ–∞–π–ª–∞ main/views.py.       
9. –©–æ–± –ø–æ—î–¥–Ω–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—ó —ñ–∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ URL —à–ª—è—Ö–∞–º–∏ –∑–∞ —è–∫–∏–º–∏ –±—É–¥—É—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ñ –Ω–∞—à—ñ –≤–µ–± —Å—Ç–æ—Ä—ñ–Ω–∫–∏, –∑–∞–ø–æ–≤–Ω–∏–≤ —Ñ–∞–π–ª main/urls.py –∑–≥—ñ–¥–Ω–æ –∑—Ä–∞–∑–∫–∞.–ë—É–¥–µ –¥–≤–∞ URL –ø–æ—Å–∏–ª–∞–Ω–Ω—è:
       
       - –≥–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ —è–∫–∞ –±—É–¥–µ –æ–ø—Ä–∞—Ü—å–æ–≤—É–≤–∞—Ç–∏—Å—å —Ñ—É–Ω–∫—Ü—ñ—î—é main;
       - —Å—Ç–æ—Ä—ñ–Ω–∫–∞ health/ —è–∫–∞ –±—É–¥–µ –æ–ø—Ä–∞—Ü—å–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—î—é health;
   –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –∫—Ä–æ–∫—ñ–≤:
![](photos/2.jpg)
![](photos/3.jpg)
10. –ó—Ä–æ–±–∏–≤ –∫–æ–º—ñ—Ç –∑ —Ü–∏–º–∏ –∑–º—ñ–Ω–∞–º–∏ –¥–æ  —Å–≤–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é.
11. –í—Å—Ç–∞–Ω–æ–≤–∏–≤ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É ```requests``` —Ç–∞ –∑–∞–ø—É—Å—Ç–∏–≤ —Ñ–∞–π–ª ```monitoring.py```
      #####–†–µ–∑—É–ª—å—Ç–∞—Ç - —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —Ñ–∞–π–ª ```server.log``` –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º –≤–º—ñ—Å—Ç–æ–º:
           
        INFO 2020-11-22 17:09:33,877 root : –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–Ω–∏–π. –ß–∞—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ: test1
        INFO 2020-11-22 17:09:33,878 root : –ó–∞–ø–∏—Ç—É–≤–∞–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞: : test2
        INFO 2020-11-22 17:09:33,878 root : –í—ñ–¥–ø–æ–≤—ñ–¥—å —Å–µ—Ä–≤–µ—Ä–∞ –º—ñ—Å—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ –ø–æ–ª—è:
        INFO 2020-11-22 17:09:33,878 root : –ö–ª—é—á: date, –ó–Ω–∞—á–µ–Ω–Ω—è: test1
        INFO 2020-11-22 17:09:33,878 root : –ö–ª—é—á: current_page, –ó–Ω–∞—á–µ–Ω–Ω—è: test2
        INFO 2020-11-22 17:09:33,878 root : –ö–ª—é—á: server_info, –ó–Ω–∞—á–µ–Ω–Ω—è: test3
        INFO 2020-11-22 17:09:33,878 root : –ö–ª—é—á: client_info, –ó–Ω–∞—á–µ–Ω–Ω—è: test4
12. –í—ñ–¥–∫—Ä–∏–≤ —Å—Ç–æ—Ä—ñ–Ω–∫—É ```health``` –≤ –±—Ä–∞—É–∑–µ—Ä—ñ:<br/>
![](photos/4.jpg)
13. * –º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞–≤ —Ñ—É–Ω–∫—Ü—ñ—é ```health``` —â–æ–± –≥–µ–Ω–µ—Ä—É–≤–∞–≤—Å—è –ø–µ—Ä–µ—Ä—ñ–∫ –∑–∞–¥–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö:
        
          def health(request):
              response = {'date': get_current_time(), 'current_page': request.build_absolute_uri(), 'server_info': request.META['SERVER_NAME'] + " " + sys.platform, 'client_info': request.META['HTTP_USER_AGENT'] + "    IP:" + request.META['REMOTE_ADDR']}
              return JsonResponse(response)
    * –¥–æ–ø–∏—Å–∞–≤ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –ø—Ä–æ–≥—Ä–∞–º–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Å–∞–π—Ç—É:
          
          def main(url):
              try:
                  r = requests.get(url)
              except requests.exceptions.RequestException as e:
                  logging.error(e)
                  logging.error("–ù–µ–º–∞—î –∑–≤'—è–∑–∫—É –∑ —Å–µ—Ä–≤–µ—Ä–æ–º")
                  raise ConnectionError
          
              if r:
                  data = json.loads(r.content)
                  logging.info("–°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–Ω–∏–π. –ß–∞—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ: %s", data['date'])
                  logging.info("–ó–∞–ø–∏—Ç—É–≤–∞–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞: : %s", data['current_page'])
                  logging.info("–í—ñ–¥–ø–æ–≤—ñ–¥—å —Å–µ—Ä–≤–µ—Ä–∞ –º—ñ—Å—Ç–∏—Ç—å –Ω–∞—Å—Ç—É–ø–Ω—ñ –ø–æ–ª—è:")
                  for key in data.keys():
                      logging.info("–ö–ª—é—á: %s, –ó–Ω–∞—á–µ–Ω–Ω—è: %s", key, data[key])
    * –¥–æ–±–∞–≤–∏–≤ —Ü–∏–∫–ª –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é –æ–Ω–æ–≤–ª–µ–Ω–Ω—è 60 —Å–µ–∫—É–Ω–¥ —Ç–∞ –∑–∞–ø—É—Å—Ç–∏–≤ –ø—Ä–æ–≥—Ä–∞–º—É —É –±–µ–∫–≥—Ä–∞—É–Ω–¥—ñ:
            
            python3 monitoring.py &
    * –¥–æ–¥–∞–≤ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫—É –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É:
            
            [scripts]
            server = "python manage.py runserver 0.0.0.0:8000"
            monitoring = "python monitoring.py"
14. –ó–∞–ø—É—Å—Ç–∏–≤ —Å–µ—Ä–≤–µ—Ä —Ç–∞ –ø–µ—Ä–µ–∫–æ–Ω–∞–≤—Å—è —â–æ –≥–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è. –ó–∞–ø—É—Å—Ç–∏–≤ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥. –ó—Ä–æ–±–∏–≤ –∫–æ–º—ñ—Ç –∑ —É—Å—ñ–º–∞ –∑–º—ñ–Ω–∞–º–∏.